"use strict";function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(a){return void c(a)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}require("babel-polyfill");var logger=require("winston"),puppeteer=require("puppeteer");logger.remove(logger.transports.Console),logger.add(logger.transports.Console,{level:"debug",colorize:!0,prettyPrint:!0}),logger.addColors({info:"blue",error:"red"});var getDancingGnomeDraftList=function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(){var b,c,d;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,puppeteer.launch().catch(function(a){return logger.error(a)});case 2:return b=a.sent,a.next=5,b.newPage().catch(function(a){return logger.error(a)});case 5:return c=a.sent,a.next=8,c.goto("http://www.dancinggnomebeer.com/the-beer/").catch(function(a){return logger.error(a)});case 8:return a.next=10,c.$$eval(".index-section-wrapper .sqs-block-content h2",function(a){var b=[];return a.forEach(function(a){""!==a.innerText&&b.push(a.innerText)}),b}).catch(function(a){return logger.error(a)});case 10:return d=a.sent,b.close(),logger.debug(d),a.abrupt("return",d);case 14:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),buildOnTapResponse=function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b){var c,d,e;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if("dancing gnome"===b){a.next=2;break}return a.abrupt("return",{speech:"<speak>Sorry, we only know about Dancing Gnome's taplist right now. Check back later for more breweries.</speak>",display:"Sorry, we only know about Dancing Gnome's taplist right now. Check back later for more breweries."});case 2:return a.next=4,getDancingGnomeDraftList();case 4:return c=a.sent,d="",e="",c.forEach(function(a,b){b===c.length-1?(d=d+" and "+a+" <break time='250ms' />",e=e+"and "+a+"."):(d=d+" "+a+"<break time='250ms' />",e=""+e+a+", ")}),a.abrupt("return",{speech:"<speak>on tap at Dancing Gnome today we have "+d+" </speak>",display:"On tap at Dancing Gnome today we have: "+e});case 9:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}(),whatsOnTapWebhook=function(){var a=_asyncToGenerator(regeneratorRuntime.mark(function a(b,c){var d,e,f,g;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:d=b.body.result.metadata.intentName,logger.debug("intent = "+d),e={speech:"",displayText:"",data:{google:{expect_user_response:!0,is_ssml:!0}},contextOut:[]},a.t0=d,a.next="test"===a.t0?6:"on_tap"===a.t0?10:19;break;case 6:return e.speech="<speak>Test case. Initiating ones and zeros. Beep boop. <break time='250ms' /> Bop. <break time='500ms' /> Boop beep.</speak>",e.displayText="Test case. Initiating ones and zeros. Beep boop. Bop. Boop beep.",c.json(e),a.abrupt("break",22);case 10:return f=b.body.result.parameters.brewery,logger.debug("brewery: "+f),a.next=14,buildOnTapResponse(f);case 14:return g=a.sent,e.speech=g.speech,e.displayText=g.display,c.json(e),a.abrupt("break",22);case 19:return logger.debug("switch-case in default"),c.json(e),a.abrupt("break",22);case 22:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}();buildOnTapResponse("dancing gnome").then(function(a){logger.debug(a)}).catch(function(a){return logger.error(a)}),exports.whatsOnTapWebhook=whatsOnTapWebhook;
